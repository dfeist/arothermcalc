<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>aroTHERM COP Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind via CDN for quick style (optional) -->
  <style>
    body { font-family: system-ui, sans-serif; max-width: 500px; margin: 2em auto; padding: 0 1rem; }
    label { display: block; margin-top: 1em; }
    input[type="number"] { width: 100%; box-sizing: border-box; padding: .4em; }
    button { margin-top: 1.5em; padding: 0.5em 1em; border: 0; background: #2563eb; color: #fff; border-radius: .375rem; cursor: pointer; }
    button:hover { background: #1d4ed8; }
    .result { background: #f8fafc; border-radius: .5rem; padding: 1em; margin-top: 2em; border: 1px solid #e2e8f0; }
    table { width:100%; border-collapse: collapse; margin-top: 1em; }
    th,td { padding:.3em .6em; border-bottom:1px solid #e2e8f0; text-align:left; }
    h1 { font-size: 1.4rem; font-weight: 600; }
  </style>
</head>
<body>
  <h1>aroTHERM&nbsp;plus&nbsp;7&nbsp;kW COP Calculator</h1>
  <form id="cop-form">
    <label>
      Outdoor temperature (°C):
      <input id="outdoor" type="number" step="0.1" required value="10">
    </label>
    <label>
      Flow temperature (°C):
      <input id="flow" type="number" step="0.1" required value="30">
    </label>
    <label>
      Return temperature (°C):
      <input id="return" type="number" step="0.1" required>
    </label>
    <button type="submit">Calculate COP</button>
  </form>

  <div id="result" class="result" style="display:none"></div>

  <script>
  // ── helper look‑ups (same logic as before) ─────────────────────────────────
  function condOffset(flow){ return flow <= 37 ? 3 : (flow <= 52 ? 4 : 5); }
  function evapOffset(outdoor){ return outdoor >= 5 ? 5 : (outdoor >= 0 ? 6 : (outdoor >= -5 ? 7 : 8)); }
  function etaCarnot(outdoor, flow){
    let eta = outdoor >= 5 ? 0.48 : (outdoor >= 0 ? 0.47 : (outdoor >= -5 ? 0.45 : 0.44));
    if (flow >= 50) eta -= 0.03; else if (flow >= 40) eta -= 0.02;
    return Math.round(eta*1000)/1000;
  }
  function calcCOP(out, flow, ret){
    const Tc = (flow+ret)/2 + condOffset(flow) + 273.15;
    const Te = out - evapOffset(out) + 273.15;
    const copCarnot = Tc / (Tc - Te);
    const eta = etaCarnot(out, flow);
    return { copCarnot, copReal: eta*copCarnot, eta, dTc: condOffset(flow), dTe: evapOffset(out) };
  }

  // ── UI glue ──────────────────────────────────────────────────────────────
  const flowEl = document.getElementById('flow');
  const retEl  = document.getElementById('return');

  // auto‑fill return = flow‑5 on load and when flow changes (unless user edits)
  const defaultDelta = 5;
  function setReturnDefault(){ retEl.value = (parseFloat(flowEl.value||0) - defaultDelta).toFixed(1); }
  // initial
  setReturnDefault();
  // update when flow changes
  flowEl.addEventListener('input', setReturnDefault);

  document.getElementById('cop-form').addEventListener('submit', e => {
    e.preventDefault();
    const out  = parseFloat(document.getElementById('outdoor').value);
    const flow = parseFloat(flowEl.value);
    const ret  = parseFloat(retEl.value);
    if(isNaN(out)||isNaN(flow)||isNaN(ret)) return alert('Enter valid numbers');

    const {copCarnot, copReal, eta, dTc, dTe} = calcCOP(out, flow, ret);
    document.getElementById('result').innerHTML = `
      <table>
        <tr><th>Condensing offset</th><td>${dTc.toFixed(1)} K</td></tr>
        <tr><th>Evaporator offset</th><td>${dTe.toFixed(1)} K</td></tr>
        <tr><th>Carnot efficiency (η)</th><td>${eta}</td></tr>
        <tr><th>Carnot COP</th><td>${copCarnot.toFixed(2)}</td></tr>
        <tr><th>Expected COP</th><td>${copReal.toFixed(2)}</td></tr>
      </table>`;
    document.getElementById('result').style.display='block';
  });
  </script>
</body>
</html>
